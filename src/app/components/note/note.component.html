<div class="window-frame">
    <div class="window-frame-titlebar">
        <div class="window-frame-titlebar-dragarea"></div>
        <app-notebook-switcher [noteId]="noteId" *ngIf="!appearance.windowHasNativeTitleBar"></app-notebook-switcher>
        <app-window-controls *ngIf="!appearance.windowHasNativeTitleBar"></app-window-controls>
    </div>
    <div class="window-frame-overlay" *ngIf="isBusy">
        <mat-spinner class="mt-4" [diameter]="100"></mat-spinner>
    </div>
    <div class="window-frame-content" [ngStyle]="{ top: appearance.windowHasNativeTitleBar ? '0' : '32px' }">
        <div class="note-content">
            <div class="note-content-floating">
                <button
                    class="note-content-floating-button"
                    mat-fab
                    (click)="toggleShowActions()"
                    matTooltip="{{ 'Tooltips.Actions' | translate }}"
                >
                    <div [@actionIconRotation]="actionIconRotation">
                        <i class="note-content-floating-button-icon las la-edit" *ngIf="!canPerformActions"></i>
                        <i class="note-content-floating-button-icon las la-times" *ngIf="canPerformActions"></i>
                    </div>
                </button>
                <button
                    *ngIf="canPerformActions"
                    class="note-content-floating-button"
                    mat-mini-fab
                    color=""
                    (click)="openSearchBottomSheet()"
                    matTooltip="{{ 'Tooltips.Search' | translate }}"
                >
                    <i class="note-content-floating-button-icon-action las la-search"></i>
                </button>
                <button
                    *ngIf="canPerformActions && isMarked"
                    class="note-content-floating-button"
                    mat-mini-fab
                    color=""
                    (click)="toggleNoteMark()"
                    matTooltip="{{ 'Tooltips.UnmarkNote' | translate }}"
                >
                    <i class="note-content-floating-button-icon-action las la-heart"></i>
                </button>
                <button
                    *ngIf="canPerformActions && !isMarked"
                    class="note-content-floating-button"
                    mat-mini-fab
                    color=""
                    (click)="toggleNoteMark()"
                    matTooltip="{{ 'Tooltips.MarkNote' | translate }}"
                >
                    <i class="note-content-floating-button-icon-action lar la-heart"></i>
                </button>
                <button
                    *ngIf="canPerformActions"
                    class="note-content-floating-button"
                    mat-mini-fab
                    color=""
                    (click)="openShareBottomSheet()"
                    matTooltip="{{ 'Tooltips.Share' | translate }}"
                >
                    <i class="note-content-floating-button-icon-action las la-share-alt"></i>
                </button>
                <button
                    *ngIf="canPerformActions && !this.isEncrypted"
                    class="note-content-floating-button"
                    mat-mini-fab
                    color=""
                    (click)="encryptNoteAsync()"
                    matTooltip="{{ 'Tooltips.EncryptNote' | translate }}"
                >
                    <i class="note-content-floating-button-icon-action las la-lock"></i>
                </button>
                <button
                    *ngIf="canPerformActions && this.isEncrypted"
                    class="note-content-floating-button"
                    mat-mini-fab
                    color=""
                    (click)="decryptNoteAsync()"
                    matTooltip="{{ 'Tooltips.DecryptNote' | translate }}"
                >
                    <i class="note-content-floating-button-icon-action las la-lock-open"></i>
                </button>
                <button
                    *ngIf="canPerformActions && !this.isTrashed"
                    class="note-content-floating-button"
                    mat-mini-fab
                    color=""
                    (click)="deleteNoteAsync()"
                    matTooltip="{{ 'Tooltips.DeleteNote' | translate }}"
                >
                    <i class="note-content-floating-button-icon-action las la-trash-alt"></i>
                </button>
            </div>
            <div class="note-content-fixed" (click)="onFixedContentClick()">
                <div class="note-content-fixed-title">
                    <input
                        class="note-content-fixed-title-text"
                        type="text"
                        [(ngModel)]="noteTitle"
                        (ngModelChange)="onNoteTitleChange($event)"
                        (keydown)="onTitleKeydown($event)"
                    />
                </div>
                <div *ngIf="!this.isMarkdownNote" class="fill w-100 h-100 overflow-hidden" id="editor"></div>
                <div *ngIf="this.isMarkdownNote" class="d-flex flex-column fill w-100 h-100 overflow-hidden">
                    <div class="d-flex flex-row">
                        <div class="markdown-edit-button no-select ml-1" (click)="toggleIsEditing()">
                            <i class="markdown-icon las la-columns" [ngClass]="{ accent: this.isEditing }"></i>
                            {{ 'Notes.Edit' | translate }}
                        </div>
                        <div class="markdown-action-separator no-select"></div>
                        <div class="markdown-action-button no-select font-bold" (click)="this.noteEditor.applyBold()" title="Bold">B</div>
                        <div class="markdown-action-button no-select font-italic" (click)="this.noteEditor.applyItalic()" title="Italic">
                            I
                        </div>
                        <div
                            class="markdown-action-button no-select font-strikethrough"
                            (click)="this.noteEditor.applyStrikeThrough()"
                            title="Strikethrough"
                        >
                            S
                        </div>
                        <div class="markdown-action-button no-select" (click)="this.noteEditor.applyHeading(1)" title="Heading 1">
                            H
                            <div class="markdown-action-button-subscript">1</div>
                        </div>
                        <div class="markdown-action-button no-select" (click)="this.noteEditor.applyHeading(2)" title="Heading 2">
                            H
                            <div class="markdown-action-button-subscript">2</div>
                        </div>
                        <div class="markdown-action-button no-select" (click)="this.noteEditor.applyHeading(3)" title="Heading 3">
                            H
                            <div class="markdown-action-button-subscript">3</div>
                        </div>
                    </div>
                    <div class="d-flex flex-row fill overflow-hidden pt-1 pb-2">
                        <textarea
                            class="markdown-input"
                            id="markdown-input"
                            [ngClass]="{ 'markdown-input-hidden': !this.isEditing }"
                            [(ngModel)]="this.noteEditor.content"
                        ></textarea>
                        <markdown
                            class="markdown-output markdown-body"
                            id="markdown-output"
                            [ngClass]="{ 'markdown-output-maximized': !this.isEditing }"
                            data="{{ this.noteEditor.content | fixImagePaths : this.noteId }}"
                        ></markdown>
                    </div>
                </div>
                <app-note-status-bar
                    [noteId]="this.noteId"
                    [isMarked]="this.isMarked"
                    [isEncrypted]="this.isEncrypted"
                ></app-note-status-bar>
            </div>
        </div>
    </div>
</div>
